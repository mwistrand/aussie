# Aussie Gateway Configuration

# Forwarding headers (RFC 7239 by default)
aussie.gateway.forwarding.use-rfc7239=true

# Request size limits
aussie.gateway.limits.max-body-size=10485760
aussie.gateway.limits.max-header-size=8192
aussie.gateway.limits.max-total-headers-size=32768

# Global access control for private endpoints (uncomment and configure as needed)
# aussie.gateway.access-control.allowed-ips=10.0.0.0/8,192.168.0.0/16,127.0.0.1
# aussie.gateway.access-control.allowed-domains=internal.example.com
# aussie.gateway.access-control.allowed-subdomains=*.internal.example.com

# =============================================================================
# Storage Configuration
# =============================================================================

# Repository provider selection
# Options: memory (default, non-persistent), cassandra
# Default uses highest priority available provider
# aussie.storage.repository.provider=cassandra

# =============================================================================
# Cache Configuration (Optional)
# =============================================================================

# Enable caching (requires Redis to be available)
aussie.storage.cache.enabled=false

# Cache provider selection (only used if cache.enabled=true)
# Options: redis
# aussie.storage.cache.provider=redis

# Cache TTL in ISO-8601 duration format
aussie.storage.cache.ttl=PT15M

# =============================================================================
# Cassandra Configuration
# =============================================================================

# Contact points (comma-separated host:port pairs)
aussie.storage.cassandra.contact-points=${CASSANDRA_CONTACT_POINTS:cassandra:9042}

# Local datacenter name
aussie.storage.cassandra.datacenter=datacenter1

# Keyspace name
aussie.storage.cassandra.keyspace=aussie

# Run database migrations on startup (default: false)
# When enabled, applies any pending CQL migrations from db/cassandra/
aussie.storage.cassandra.run-migrations=${CASSANDRA_RUN_MIGRATIONS:false}

# Authentication (uncomment for production)
# aussie.storage.cassandra.username=${CASSANDRA_USERNAME}
# aussie.storage.cassandra.password=${CASSANDRA_PASSWORD}

# =============================================================================
# Quarkus Redis Configuration
# =============================================================================

quarkus.redis.hosts=redis://localhost:6379

# Authentication (uncomment for production)
# quarkus.redis.password=${REDIS_PASSWORD}

# Health check - disabled by default (enable when Redis is available)
quarkus.redis.health.enabled=false

# =============================================================================
# Authentication Configuration
# =============================================================================

# Enable/disable authentication (default: true)
aussie.auth.enabled=true

# Only require auth for admin paths (default: true)
# When true, /admin/* requires authentication but /gateway/* and /{serviceId}/* remain open
aussie.auth.admin-paths-only=true

# DANGEROUS: Disable authentication entirely for development
# WARNING: Never enable this in production!
aussie.auth.dangerous-noop=false

# Dev profile: enable dangerous-noop for local development
%dev.aussie.auth.dangerous-noop=true

# JWT authentication (for OAuth2/OIDC setups)
# Uncomment and configure for JWT support
# aussie.auth.jwt.issuer=https://auth.example.com
# aussie.auth.jwt.audience=aussie-api
# aussie.auth.jwt.jwks-uri=https://auth.example.com/.well-known/jwks.json

# =============================================================================
# Quarkus Security Path Permissions
# =============================================================================

# Admin endpoints require authentication (enforced by @RolesAllowed on endpoints)
quarkus.http.auth.permission.admin.paths=/admin/*
quarkus.http.auth.permission.admin.policy=authenticated

# Gateway and pass-through routes remain open
quarkus.http.auth.permission.gateway.paths=/gateway/*
quarkus.http.auth.permission.gateway.policy=permit

# Health check and dev endpoints remain open
quarkus.http.auth.permission.health.paths=/q/*
quarkus.http.auth.permission.health.policy=permit

# Service pass-through (catch-all for /{serviceId}/*) - permit to allow public access
quarkus.http.auth.permission.passthrough.paths=/*
quarkus.http.auth.permission.passthrough.policy=permit

# =============================================================================
# Auth Key Storage Configuration
# =============================================================================

# Storage provider selection for API keys
# Options: memory (default, non-persistent), cassandra
# aussie.auth.storage.provider=cassandra

# Cassandra configuration for auth keys (falls back to aussie.storage.cassandra.* if not set)
# aussie.auth.storage.cassandra.contact-points=${CASSANDRA_CONTACT_POINTS:cassandra:9042}
# aussie.auth.storage.cassandra.datacenter=datacenter1
# aussie.auth.storage.cassandra.keyspace=aussie

# =============================================================================
# Auth Key Cache Configuration (Optional)
# =============================================================================

# Enable caching for API key validation (requires Redis)
aussie.auth.cache.enabled=false

# Cache provider selection
# aussie.auth.cache.provider=redis

# Cache TTL (ISO-8601 duration format)
aussie.auth.cache.ttl=PT5M

# =============================================================================
# Auth Key Encryption Configuration
# =============================================================================

# AES-256 encryption key for API key records at rest (Base64-encoded 256-bit key)
# Generate a key: openssl rand -base64 32
# SECURITY: Store this securely, e.g., in environment variable or secrets manager
# aussie.auth.encryption.key=${AUTH_ENCRYPTION_KEY}

# Key ID for encryption (used for key rotation)
aussie.auth.encryption.key-id=v1

# =============================================================================
# API Key Configuration
# =============================================================================

# Maximum TTL for API keys (ISO-8601 duration format)
# When set, API key creation will fail if requested TTL exceeds this value
# Examples: P90D (90 days), P365D (1 year), P7D (1 week)
# aussie.auth.api-keys.max-ttl=P365D

# =============================================================================
# Bootstrap Configuration
# =============================================================================

# Enable bootstrap mode for first-time admin setup
# When enabled, creates an admin API key from the provided AUSSIE_BOOTSTRAP_KEY
# Default: false (must be explicitly enabled)
aussie.bootstrap.enabled=${AUSSIE_BOOTSTRAP_ENABLED:false}

# Bootstrap key (REQUIRED when bootstrap is enabled)
# Must be at least 32 characters long
# Set via environment variable: AUSSIE_BOOTSTRAP_KEY
# aussie.bootstrap.key=${AUSSIE_BOOTSTRAP_KEY}

# Bootstrap key TTL (ISO-8601 duration format)
# Maximum allowed is PT24H (24 hours) - values exceeding this are capped
# Default: PT24H
aussie.bootstrap.ttl=${AUSSIE_BOOTSTRAP_TTL:PT24H}

# Recovery mode: allows bootstrap even when admin keys already exist
# WARNING: Only use for emergency recovery when all admin keys are lost
# Default: false
aussie.bootstrap.recovery-mode=${AUSSIE_BOOTSTRAP_RECOVERY_MODE:false}

# =============================================================================
# Health Configuration
# =============================================================================

quarkus.smallrye-health.root-path=/q/health
